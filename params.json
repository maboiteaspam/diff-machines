{"name":"Diff-machines","tagline":"diff files between machines over ssh","body":"# diff-machines\r\n\r\ndiff files between machines over ssh.\r\n\r\n## Install\r\n\r\n    npm i maboiteaspam/diff-machines -g\r\n\r\n## Usage\r\n\r\n`diff-machines` is a binary to install globally.\r\n\r\n```ssh\r\n\r\n  diff files between machines over ssh.\r\n\r\n  Usage\r\n     diff-machines [hostA] [hostB] [files or services...]\r\n     diff-machines [opts] -- [hostA] [hostB] [files or services...]\r\n\r\n  Options\r\n     -v    verbose\r\n     -h    show help\r\n\r\n Examples\r\n     diff-machines user@hostA:port user@hostB:port php .bashrc\r\n     diff-machines -v -- vagrant@loalhost:2222 vagrant@loalhost:2222 php .bashrc\r\n     diff-machines -h\r\n```\r\n\r\n__Example__\r\n\r\nIt will diff the service `php` and the file `.bashrc`\r\nbetween `vagrant` and `vagrant` boxes.\r\n\r\n```bash\r\n     diff-machines -v -- vagrant@loalhost:2222 vagrant@loalhost:2222 php .bashrc\r\n```\r\n\r\nThe result is sent to `stdout` and produce unified patch with support of `jsdiff`\r\n\r\n```sh\r\n# node bin.js vagrant vagrant php .bashrc\r\n\r\n\r\nIndex: /etc/php.ini\r\n===================================================================\r\n--- /etc/php.ini\r\n+++ /etc/php.ini\r\n\r\n\r\n\r\nIndex: .bashrc\r\n===================================================================\r\n--- .bashrc\r\n+++ .bashrc\r\n\r\n```\r\n\r\n## Configuration\r\n\r\n`diff-machines` can read a configuration file located on `cwd`.\r\n\r\nThis file is an exported `function()` which returns an `object`.\r\n\r\nThis configuration object can configure ssh `hosts` and `services` by name.\r\n\r\n`service` are functions resolver which receives an `sshConn` of `ssh2-utils`\r\nand invoke `call(err, filePath)`.\r\n\r\n`filePath` is the location of the file identified for the given `service`.\r\n\r\n__configuration__\r\n\r\n```js\r\n{\r\n    host1:{},\r\n    host2:{},\r\n    services:{\r\n        service1: function (sshConn, done){ done(err, filePath); },\r\n        service2: function (sshConn, done){ done(err, filePath); }\r\n    },\r\n}\r\n```\r\n\r\nIn this example,\r\n`php` ini file is resolved with the help of the `php` binary itself. Cross-distro.\r\n\r\n`notFound`, demonstrate that passing anything into `err` will effectively stop the program.\r\n\r\n__diff-svc.js__\r\n\r\n```js\r\n\r\nvar SSH2  = require('ssh2-utils')\r\n\r\nmodule.exports = function () {\r\n  var ssh = new SSH2();\r\n  return {\r\n    'vagrant': {\r\n      'host':'127.0.0.1',\r\n      port: 2222,\r\n      username: 'vagrant',\r\n      password: 'vagrant'\r\n    },\r\n    'services': {\r\n      'php': function (conn, done) {\r\n        ssh.exec(conn, 'php -r \"echo php_ini_loaded_file();\"', function (err, stdout, stderr) {\r\n          done(err, stdout)\r\n        })\r\n      },\r\n      'notFound': function (conn, done) {\r\n        done(false)\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n```\r\n\r\n## Re-usable services\r\n\r\nIt s possible to pass in not `service` name of the `local` config object, rather than,\r\n`module` names.\r\n\r\n\r\nSo if one would export the `php` service to a module name `php-ini`, that would look like,\r\n\r\n__index.js__\r\n\r\n```js\r\n\r\nvar SSH2  = require('ssh2-utils')\r\nvar ssh = new SSH2();\r\n\r\nmodule.exports = function (conn, done) {\r\n    ssh.exec(conn, 'php -r \"echo php_ini_loaded_file();\"', function (err, stdout, stderr) {\r\n        done(err, stdout)\r\n    });\r\n}\r\n\r\n```\r\n\r\n\r\nIt would then be possible to invoke `diff-machines` in such fashion\r\n\r\n```bash\r\n\r\ndiff-machines -v -- vagrant@loalhost:2222 vagrant@loalhost:2222 php-ini .bashrc\r\n\r\n```\r\n\r\nObviously you d need to `npm i php-ini --save` before that.\r\nThus lock the remote dependency into a package json of your projects.\r\n\r\n\r\n## More\r\n\r\n- https://github.com/kpdecker/jsdiff\r\n- https://github.com/sindresorhus/multiline\r\n- https://github.com/mscdex/ssh2/\r\n- https://github.com/maboiteaspam/ssh2-utils\r\n- https://github.com/maboiteaspam/diff-machines/blob/master/diff-svc.js\r\n\r\n\r\n## ssh & vagrant\r\n\r\n__~/.ssh/config__\r\n\r\n```\r\nHost localhost\r\n  HostName 127.0.0.1\r\n  Port 2222\r\n  StrictHostKeyChecking no\r\n```\r\n\r\n- http://serverfault.com/questions/6233/how-to-remove-strict-rsa-key-checking-in-ssh-and-whats-the-problem-here\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}